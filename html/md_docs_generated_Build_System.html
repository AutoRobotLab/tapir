<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>TAPIR: Custom non-recursive Make system</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TAPIR
   </div>
   <div id="projectbrief">An online approximate POMDP solver that can adapt to changes in the POMDP model.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Custom non-recursive Make system </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Introduction </h2>
<p>The build system uses a non-recursive approach with GNU make, similar to the one documented in the paper <a href="http://aegis.sourceforge.net/auug97.pdf">Recursive Make Considered Harmful</a> by Peter Miller, and adapting some Makefile code from <a href="http://evbergen.home.xs4all.nl/nonrecursive-make.html">here</a>.</p>
<p>The paper describes many advantages to non-recursive Make; in short, it results in a cleaner and more robust dependency tree, and it means that the code can quite easily be compiled in parallel.</p>
<p>The system used here adds two key conveniences to the aforementioned system:</p>
<ul>
<li>Improved readability by moving standard code, especially the recursion, into template files wihin the .make directory. The recursion is located in <a class="el" href="stack_8mk_source.html">stack.mk</a>.</li>
<li>The ability to call make from any child folder and have it behave the way you would expect it to if that child folder were the root.</li>
</ul>
<h2>General usage </h2>
<p>Global configuration settings are set in the <a href="../Makefile">root Makefile</a>, and then individual modules can each be configured via the Makefile in their own subfolder (e.g. <a href="../src/Makefile">this</a>).</p>
<p>The subfolder Makefiles should work more or less like normal Makefiles, although it is processed relative to the root folder, which means that any paths should be relative to the root - the variable  is provided as shorthand for the relative path of the current module w.r.t. the root.</p>
<p>Each module is also required to define two variables that are used for the recursive processing:</p>
<ul>
<li>MODULE_NAME: The module name; should be a unique identifier. This is used for generating intermediate targets for each specific module.</li>
<li>CHILD_FOLDERS: The subdirectories that are required to be processed.</li>
</ul>
<p>However, in order to mainain consistency with the rest of the build system, particularly with regards to build modes (release vs. debug) and with regards to the structure of the build output directories (e.g. builds/release and builds/debug), it is best to use the provided templates to automatically generate most of the rules. Refer to <a href="../src/Makefile">the Makefile in the src folder</a> for a simple example, or read the next section for greater depth.</p>
<h2>Makefile templates </h2>
<p>The key rules that do most of the work are located in <a class="el" href="template_8mk_source.html">template.mk</a>, which detects .cpp source files and includes a default .cpp -&gt; .o recipe, as well as automatic dependency handling.</p>
<p>To provide rules on how to build the module as a whole rather than implicitly via other modules that depend on it, you need to add the targets you want as prerequisites for the phony build targets. For example, build-solver is the target that builds the entire "solver" module.</p>
<p>The simplest way to define the build pattern for a module is to simply build every individual object file - the rule for this is given in <a class="el" href="build_8mk_source.html">build.mk</a>.</p>
<p>The solver code is currently set to build into an archive called "libtapir.a"; the rules to do this are defined in <a href="../src/solver/Makefile">the "solver" Makefile</a>. As you can see there, the rule defines all of the files that make up this library in terms of the automatic OBJS_[module] variables generated by the template code.</p>
<p>Alternatively, if you set CFG=shared, the core solver code is instead built into a shared library "libtapir.so"</p>
<h2>Problem templates </h2>
<p>A more complex example is the build template used for each individual problem, which is located in <a class="el" href="problem-template_8mk_source.html">problem-template.mk</a>. Its purpose is to defines recipes for the "solve" and "simulate" executables, which are the key executables for running TAPIR on a specific problem.</p>
<p>The core of this template is defining all of the dependencies for each problem. The default dependencies are the other object files in the same folder as solve.cpp and simulate.cpp, the solver archive libtapir.a / libtapir.so, and the external libraries libspatialindex and Eigen.</p>
<p>If your problem needs to be linked to additional libraries, you can specify this by adding those dependencies to the variable EXTRA_LINKER_ARGS_[module]. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jul 7 2014 00:14:35 for TAPIR by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
